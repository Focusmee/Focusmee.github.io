<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tokenä¸Šä¸‹æ–‡ç­–ç•¥ - æŠ€æœ¯åšå®¢</title>
    <meta name="description" content="tokenä¸Šä¸‹æ–‡ç­–ç•¥ - AIå·¥å…·ç›¸å…³æŠ€æœ¯æ–‡ç« ">
    <meta name="keywords" content="AIå·¥å…·, æŠ€æœ¯åšå®¢, ç¼–ç¨‹, å¼€å‘">
    
    <!-- CSSæ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="../../styles/main.css">
    <link rel="stylesheet" href="../../styles/post.css">
    <link rel="stylesheet" href="../../styles/highlight.css">
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="../../index.html" class="nav-brand">ğŸ“š æŠ€æœ¯åšå®¢</a>
            <div class="nav-links">
                <a href="../../index.html" class="nav-link">é¦–é¡µ</a>
                <a href="../../blog.html" class="nav-link">åšå®¢</a>
            </div>
        </div>
    </nav>

    <!-- é¢åŒ…å±‘å¯¼èˆª -->
    <div class="breadcrumb">
        <div class="container">
            <a href="../../index.html">é¦–é¡µ</a>
            <span class="separator">â€º</span>
            <a href="../../blog.html">åšå®¢</a>
            <span class="separator">â€º</span>
            <span class="category-breadcrumb">AIå·¥å…·</span>
            <span class="separator">â€º</span>
            <span class="current-page">tokenä¸Šä¸‹æ–‡ç­–ç•¥</span>
        </div>
    </div>

    <!-- æ–‡ç« å®¹å™¨ - ç›®å½•åŠŸèƒ½ä¼šåœ¨è¿™é‡ŒåŠ¨æ€æ’å…¥ -->
    <div class="container">
        <article class="post-container">
            <!-- æ–‡ç« å¤´éƒ¨ -->
            <header class="post-header">
                <div class="post-meta">
                    <span class="category-tag ai-tools">ğŸ¤– AIå·¥å…·</span>
                    <time class="publish-date" datetime="2025-06-25">2025-06-25</time>
                    <span class="read-time">ğŸ“– 10 åˆ†é’Ÿé˜…è¯»</span>
                </div>
                <h1 class="post-title">tokenä¸Šä¸‹æ–‡ç­–ç•¥</h1>
            </header>
            
            <!-- æ–‡ç« å†…å®¹ -->
            <main class="post-content">
                <p><h1>ã€AgentXã€‘tokenä¸Šä¸‹æ–‡ç­–ç•¥</h1><br /><br />åŸºäº AgentX é¡¹ç›®çš„å®é™…ä»£ç å®ç°ï¼Œæˆ‘æ¥å›ç­”è¿™äº›é¢è¯•é—®é¢˜ï¼š<br /><br /><h2>ğŸ—ï¸ ç³»ç»Ÿè®¾è®¡ç±»é—®é¢˜</h2><br /><br /><h3>1. "è¯·è®¾è®¡ä¸€ä¸ªæ”¯æŒå¤šç§ Token ç®¡ç†ç­–ç•¥çš„å¯æ‰©å±•æ¶æ„"</h3><br /><br /><strong>åŸºäº AgentX çš„å›ç­”ï¼š</strong><br /><br />AgentX é‡‡ç”¨äº†ç­–ç•¥æ¨¡å¼ + å·¥å‚æ¨¡å¼çš„ç»å…¸æ¶æ„ï¼š<br /><br />```java<br />// ç­–ç•¥æ¥å£<br />public interface TokenOverflowStrategy {<br />    TokenProcessResult process(List<TokenMessage> messages, TokenOverflowConfig config);<br />    String getName();<br />    boolean needsProcessing(List<TokenMessage> messages);<br />}<br /><br />// å·¥å‚ç±»è´Ÿè´£åˆ›å»ºç­–ç•¥å®ä¾‹<br />@Service<br />public class TokenOverflowStrategyFactory {<br />    public static TokenOverflowStrategy createStrategy(<br />        TokenOverflowStrategyEnum strategyType, <br />        TokenOverflowConfig config) {<br />        switch (strategyType) {<br />            case SLIDING_WINDOW: return new SlidingWindowTokenOverflowStrategy(config);<br />            case SUMMARIZE: return new SummarizeTokenOverflowStrategy(config);<br />            case NONE: <br />            default: return new NoTokenOverflowStrategy();<br />        }<br />    }<br />}<br />```<br /><br /><strong>æ¶æ„ä¼˜åŠ¿ï¼š</strong><br />- <strong>å¯æ‰©å±•æ€§</strong>ï¼šæ–°å¢ç­–ç•¥åªéœ€å®ç° `TokenOverflowStrategy` æ¥å£<br />- <strong>é…ç½®é©±åŠ¨</strong>ï¼šé€šè¿‡ `TokenOverflowConfig` ç»Ÿä¸€ç®¡ç†ç­–ç•¥å‚æ•°<br />- <strong>è§£è€¦åˆ</strong>ï¼šç­–ç•¥å®ç°ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»<br /><br /><h3>2. "å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘åœºæ™¯ä¸‹çš„ä¸Šä¸‹æ–‡ç®¡ç†ç³»ç»Ÿï¼Ÿ"</h3><br /><br /><strong>AgentX çš„å¹¶å‘å¤„ç†è®¾è®¡ï¼š</strong><br /><br />```java<br />// ä¸Šä¸‹æ–‡å¤„ç†å™¨ä½¿ç”¨ Spring ç®¡ç†å¹¶å‘<br />@Service<br />public class ContextProcessor {<br />    // é€šè¿‡ä¾èµ–æ³¨å…¥ä¿è¯çº¿ç¨‹å®‰å…¨<br />    private final ContextDomainService contextDomainService;<br />    private final MessageDomainService messageDomainService;<br />    private final TokenDomainService tokenDomainService;<br />    <br />    // æ¯ä¸ªä¼šè¯ç‹¬ç«‹å¤„ç†ï¼Œé¿å…å…±äº«çŠ¶æ€<br />    public ContextResult processContext(String sessionId, ...) {<br />        ContextEntity contextEntity = contextDomainService.findBySessionId(sessionId);<br />        // åŸºäº sessionId éš”ç¦»ï¼Œå¤©ç„¶æ”¯æŒå¹¶å‘<br />    }<br />}<br />```<br /><br /><strong>å¹¶å‘å®‰å…¨ä¿è¯ï¼š</strong><br />- <strong>æ— çŠ¶æ€è®¾è®¡</strong>ï¼šç­–ç•¥ç±»ä¸ç»´æŠ¤çŠ¶æ€ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½æ˜¯ç‹¬ç«‹çš„<br />- <strong>ä¼šè¯éš”ç¦»</strong>ï¼šåŸºäº `sessionId` è¿›è¡Œæ•°æ®éš”ç¦»<br />- <strong>äº‹åŠ¡ç®¡ç†</strong>ï¼šä½¿ç”¨ `@Transactional` ä¿è¯æ•°æ®ä¸€è‡´æ€§<br /><br /><h2>ğŸ”§ ç®—æ³•å’ŒæŠ€æœ¯å®ç°ç±»é—®é¢˜</h2><br /><br /><h3>3. "å¦‚ä½•ç²¾ç¡®è®¡ç®—ä¸åŒæ¨¡å‹çš„ Token æ•°é‡ï¼Ÿ"</h3><br /><br /><strong>AgentX çš„ Token è®¡ç®—å®ç°ï¼š</strong><br /><br />```java<br />// å½“å‰å®ç°ä¸­ï¼ŒToken æ•°é‡å­˜å‚¨åœ¨ TokenMessage ä¸­<br />public class TokenMessage {<br />    private Integer tokenCount; // é¢„è®¡ç®—çš„ token æ•°é‡<br />    <br />    // åœ¨æ¶ˆæ¯åˆ›å»ºæ—¶è®¡ç®—å¹¶ç¼“å­˜<br />    public void setTokenCount(Integer tokenCount) {<br />        this.tokenCount = tokenCount;<br />    }<br />}<br /><br />// æ»‘åŠ¨çª—å£ç­–ç•¥ä¸­çš„ Token è®¡ç®—<br />private int calculateTotalTokens(List<TokenMessage> messages) {<br />    return messages.stream()<br />        .mapToInt(m -> m.getTokenCount() != null ? m.getTokenCount() : 0)<br />        .sum();<br />}<br />```<br /><br /><strong>æŒ‘æˆ˜å’Œè§£å†³æ–¹æ¡ˆï¼š</strong><br />- <strong>æ¨¡å‹å·®å¼‚æ€§</strong>ï¼šä¸åŒæ¨¡å‹æœ‰ä¸åŒçš„ tokenizerï¼Œéœ€è¦é€‚é…<br />- <strong>è®¡ç®—æ€§èƒ½</strong>ï¼šAgentX é‡‡ç”¨é¢„è®¡ç®— + ç¼“å­˜çš„æ–¹å¼é¿å…é‡å¤è®¡ç®—<br />- <strong>å‡†ç¡®æ€§ä¿è¯</strong>ï¼šå»ºè®®é›†æˆå…·ä½“æ¨¡å‹çš„ tokenizer åº“<br /><br /><h3>4. "æ‘˜è¦ç®—æ³•å¦‚ä½•ä¿è¯ä¸ä¸¢å¤±å…³é”®ä¿¡æ¯ï¼Ÿ"</h3><br /><br /><strong>AgentX çš„æ‘˜è¦å®ç°åˆ†æï¼š</strong><br /><br />```java<br />private String generateSummary(List<TokenMessage> messages, TokenOverflowConfig config) {<br />    // ä½¿ç”¨ä¸“é—¨çš„æ‘˜è¦æç¤ºè¯<br />    SystemMessage systemMessage = new SystemMessage(<br />        "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å¯¹è¯æ‘˜è¦ç”Ÿæˆå™¨ï¼Œè¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹è¦æ±‚å·¥ä½œï¼š\n" +<br />        "1. åªåŸºäºæä¾›çš„å¯¹è¯å†…å®¹ç”Ÿæˆå®¢è§‚æ‘˜è¦ï¼Œä¸å¾—æ·»åŠ ä»»ä½•åŸå¯¹è¯ä¸­æ²¡æœ‰çš„ä¿¡æ¯\n" +<br />        "2. ç‰¹åˆ«å…³æ³¨ï¼šç”¨æˆ·é—®é¢˜ã€å›ç­”ä¸­çš„å…³é”®ä¿¡æ¯ã€é‡è¦äº‹å®\n" +<br />        "3. å»é™¤æ‰€æœ‰å¯’æš„ã€è¡¨æƒ…ç¬¦å·å’Œæƒ…æ„Ÿè¡¨è¾¾\n" +<br />        "4. ä½¿ç”¨ç®€æ´çš„ç¬¬ä¸‰äººç§°é™ˆè¿°å¥\n" +<br />        "5. ä¿æŒæ—¶é—´é¡ºåºå’Œé€»è¾‘å…³ç³»\n" +<br />        "6. ç¤ºä¾‹æ ¼å¼ï¼š[ç”¨æˆ·]é—®... [AI]å›ç­”...\n"<br />    );<br />}<br />```<br /><br /><strong>è´¨é‡ä¿è¯æœºåˆ¶ï¼š</strong><br />- <strong>ç»“æ„åŒ–æç¤ºè¯</strong>ï¼šæ˜ç¡®æŒ‡å¯¼æ‘˜è¦ç”Ÿæˆçš„è§„åˆ™<br />- <strong>é‡è¦ä¿¡æ¯æ ‡è¯†</strong>ï¼šç‰¹åˆ«å…³æ³¨ç”¨æˆ·é—®é¢˜å’Œå…³é”®å›ç­”<br />- <strong>æ ¼å¼è§„èŒƒ</strong>ï¼šä½¿ç”¨ç»Ÿä¸€çš„æ‘˜è¦æ ¼å¼ä¾¿äºåç»­å¤„ç†<br /><br /><h2>ğŸ“Š æ€§èƒ½å’Œå¹¶å‘é—®é¢˜</h2><br /><br /><h3>5. "åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¦‚ä½•ä¼˜åŒ– Token è®¡ç®—çš„æ€§èƒ½ï¼Ÿ"</h3><br /><br /><strong>AgentX çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼š</strong><br /><br />```java<br />// 1. é¢„è®¡ç®— Token æ•°é‡ï¼Œé¿å…å®æ—¶è®¡ç®—<br />public class TokenMessage {<br />    private Integer tokenCount; // æ¶ˆæ¯åˆ›å»ºæ—¶å°±è®¡ç®—å¥½<br />}<br /><br />// 2. æ‰¹é‡å¤„ç†æ¶ˆæ¯<br />public TokenProcessResult process(List<TokenMessage> messages, TokenOverflowConfig config) {<br />    // ä¸€æ¬¡æ€§å¤„ç†æ•´ä¸ªæ¶ˆæ¯åˆ—è¡¨ï¼Œå‡å°‘æ•°æ®åº“è®¿é—®<br />    int totalTokens = calculateTotalTokens(messages);<br />}<br /><br />// 3. é…ç½®ç¼“å­˜é¿å…é‡å¤åˆ›å»ºç­–ç•¥å¯¹è±¡<br />@Service<br />public class TokenOverflowStrategyFactory {<br />    // å¯ä»¥å¢åŠ ç­–ç•¥å®ä¾‹ç¼“å­˜<br />}<br />```<br /><br /><h3>6. "æ‘˜è¦ç”Ÿæˆæ˜¯ I/O å¯†é›†å‹æ“ä½œï¼Œå¦‚ä½•è®¾è®¡å¼‚æ­¥å¤„ç†ï¼Ÿ"</h3><br /><br /><strong>å½“å‰åŒæ­¥å®ç°çš„é—®é¢˜ï¼š</strong><br /><br />```java<br />// å½“å‰å®ç°æ˜¯åŒæ­¥çš„ï¼Œä¼šé˜»å¡ç”¨æˆ·è¯·æ±‚<br />String summary = generateSummary(messagesToSummarize, tokenOverflowConfig);<br />```<br /><br /><strong>å»ºè®®çš„å¼‚æ­¥ä¼˜åŒ–ï¼š</strong><br /><br />```java<br />// å¯ä»¥è®¾è®¡å¼‚æ­¥æ‘˜è¦ç”Ÿæˆ<br />@Async("summaryExecutor")<br />public CompletableFuture<String> generateSummaryAsync(List<TokenMessage> messages) {<br />    // å¼‚æ­¥ç”Ÿæˆæ‘˜è¦ï¼Œç”¨æˆ·è¯·æ±‚ä¸è¢«é˜»å¡<br />    // å¯ä»¥å…ˆè¿”å›ä¸´æ—¶çš„æ»‘åŠ¨çª—å£ç»“æœï¼Œæ‘˜è¦å®Œæˆåå†æ›´æ–°<br />}<br />```<br /><br /><h2>ğŸ¯ ä¸šåŠ¡é€»è¾‘å’Œè¾¹ç•Œæƒ…å†µ</h2><br /><br /><h3>7. "åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹åº”è¯¥é€‰æ‹©æ»‘åŠ¨çª—å£ vs æ‘˜è¦ç­–ç•¥ï¼Ÿ"</h3><br /><br /><strong>åŸºäº AgentX ä»£ç çš„åˆ†æï¼š</strong><br /><br />```java<br />// æ»‘åŠ¨çª—å£ç­–ç•¥ - é€‚åˆç®€å•å¯¹è¯<br />public class SlidingWindowTokenOverflowStrategy {<br />    // ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ— éœ€é¢å¤–LLMè°ƒç”¨ï¼Œå»¶è¿Ÿä½<br />    // ç¼ºç‚¹ï¼šå†å²ä¿¡æ¯å®Œå…¨ä¸¢å¤±<br />    // é€‚ç”¨ï¼šé—®ç­”ç±»ã€ä¸éœ€è¦é•¿æœŸè®°å¿†çš„åœºæ™¯<br />}<br /><br />// æ‘˜è¦ç­–ç•¥ - é€‚åˆå¤æ‚å¯¹è¯<br />public class SummarizeTokenOverflowStrategy {<br />    // ä¼˜ç‚¹ï¼šä¿ç•™å…³é”®å†å²ä¿¡æ¯<br />    // ç¼ºç‚¹ï¼šéœ€è¦é¢å¤–LLMè°ƒç”¨ï¼Œæœ‰å»¶è¿Ÿå’Œæˆæœ¬<br />    // é€‚ç”¨ï¼šéœ€è¦ä¸Šä¸‹æ–‡è¿è´¯æ€§çš„å¤æ‚å¯¹è¯<br />}<br />```<br /><br /><strong>é€‰æ‹©ç­–ç•¥ï¼š</strong><br />- <strong>å®¢æœåœºæ™¯</strong>ï¼šæ»‘åŠ¨çª—å£ï¼ˆæ¯æ¬¡å¯¹è¯ç›¸å¯¹ç‹¬ç«‹ï¼‰<br />- <strong>ç¼–ç¨‹åŠ©æ‰‹</strong>ï¼šæ‘˜è¦ç­–ç•¥ï¼ˆéœ€è¦è®°ä½ä¹‹å‰çš„ä»£ç ä¸Šä¸‹æ–‡ï¼‰<br />- <strong>åˆ›ä½œåŠ©æ‰‹</strong>ï¼šæ‘˜è¦ç­–ç•¥ï¼ˆéœ€è¦ä¿æŒåˆ›ä½œè¿è´¯æ€§ï¼‰<br /><br /><h3>8. "å¦‚æœå•æ¡æ¶ˆæ¯å°±è¶…è¿‡æ¨¡å‹ä¸Šä¸‹æ–‡é™åˆ¶æ€ä¹ˆåŠï¼Ÿ"</h3><br /><br /><strong>AgentX å½“å‰å®ç°çš„ä¸è¶³ï¼š</strong><br /><br />```java<br />// å½“å‰ä»£ç æ²¡æœ‰å¤„ç†å•æ¡æ¶ˆæ¯è¿‡é•¿çš„æƒ…å†µ<br />private int calculateTotalTokens(List<TokenMessage> messages) {<br />    return messages.stream().mapToInt(m -> m.getTokenCount() != null ? m.getTokenCount() : 0).sum();<br />}<br />```<br /><br /><strong>å»ºè®®çš„å¤„ç†æ–¹æ¡ˆï¼š</strong><br /><br />```java<br />public class MessageSplitter {<br />    // å¯¹è¶…é•¿æ¶ˆæ¯è¿›è¡Œæ™ºèƒ½åˆ†å‰²<br />    public List<TokenMessage> splitLongMessage(TokenMessage longMessage, int maxTokens) {<br />        // æŒ‰æ®µè½ã€å¥å­è¾¹ç•Œè¿›è¡Œåˆ†å‰²<br />        // ä¿æŒè¯­ä¹‰å®Œæ•´æ€§<br />    }<br />}<br />```<br /><br /><h2>ğŸ” æ•°æ®ä¸€è‡´æ€§å’Œå¯é æ€§</h2><br /><br /><h3>9. "ä¸Šä¸‹æ–‡æ›´æ–°å’Œæ¶ˆæ¯ä¿å­˜å¦‚ä½•ä¿è¯äº‹åŠ¡ä¸€è‡´æ€§ï¼Ÿ"</h3><br /><br /><strong>AgentX çš„äº‹åŠ¡ç®¡ç†ï¼š</strong><br /><br />```java<br />@Service<br />public class ChatCompletionHandlerImpl implements ChatCompletionHandler {<br />    <br />    @Override<br />    @Transactional  // ä½¿ç”¨äº‹åŠ¡ä¿è¯ä¸€è‡´æ€§<br />    public void handleCompletion(MessageEntity userMessage, MessageEntity llmMessage, <br />                                ContextEntity contextEntity, ...) {<br />        try {<br />            // 1. ä¿å­˜æ¶ˆæ¯<br />            List<MessageEntity> messages = Arrays.asList(userMessage, llmMessage);<br />            conversationDomainService.saveMessages(messages);<br />            <br />            // 2. æ›´æ–°ä¸Šä¸‹æ–‡<br />            contextDomainService.updateContext(contextEntity);<br />        } catch (Exception e) {<br />            // äº‹åŠ¡å›æ»šï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§<br />            throw new BusinessException("èŠå¤©å®Œæˆå¤„ç†å¤±è´¥", e);<br />        }<br />    }<br />}<br />```<br /><br /><h3>10. "å¦‚ä½•è®¾è®¡ç›‘æ§æŒ‡æ ‡æ¥è¯„ä¼° Token ç®¡ç†ç­–ç•¥çš„æ•ˆæœï¼Ÿ"</h3><br /><br /><strong>åŸºäº AgentX å¯ä»¥å¢åŠ çš„ç›‘æ§æŒ‡æ ‡ï¼š</strong><br /><br />```java<br />@Component<br />public class TokenManagementMetrics {<br />    <br />    // 1. ç­–ç•¥ä½¿ç”¨ç»Ÿè®¡<br />    public void recordStrategyUsage(String sessionId, TokenOverflowStrategyEnum strategy) {<br />        // ç»Ÿè®¡å„ç§ç­–ç•¥çš„ä½¿ç”¨é¢‘ç‡<br />    }<br />    <br />    // 2. Token èŠ‚çœæ•ˆæœ<br />    public void recordTokenSavings(String sessionId, int originalTokens, int processedTokens) {<br />        double savingRatio = (originalTokens - processedTokens) / (double) originalTokens;<br />        // è®°å½• Token èŠ‚çœæ¯”ä¾‹<br />    }<br />    <br />    // 3. æ‘˜è¦è´¨é‡è¯„ä¼°<br />    public void recordSummaryMetrics(String sessionId, int originalMessages, int summaryTokens) {<br />        // è®°å½•æ‘˜è¦å‹ç¼©æ¯”ä¾‹<br />    }<br />    <br />    // 4. ç”¨æˆ·ä½“éªŒæŒ‡æ ‡<br />    public void recordUserSatisfaction(String sessionId, boolean contextLoss) {<br />        // è®°å½•ç”¨æˆ·æ˜¯å¦æ„Ÿå—åˆ°ä¸Šä¸‹æ–‡ä¸¢å¤±<br />    }<br />}<br />```<br /><br /><h2>ğŸ’¡ ä»£ç è´¨é‡å’Œæœ€ä½³å®è·µ</h2><br /><br /><h3>11. "å½“å‰ä»£ç ä¸­ä½ çœ‹åˆ°å“ªäº›å¯ä»¥æ”¹è¿›çš„åœ°æ–¹ï¼Ÿ"</h3><br /><br /><strong>åŸºäºä»£ç åˆ†æçš„æ”¹è¿›å»ºè®®ï¼š</strong><br /><br />1. <strong>ç¡¬ç¼–ç é—®é¢˜ï¼š</strong><br />```java<br />// å½“å‰ä»£ç ä¸­çš„ç¡¬ç¼–ç <br />message.setTokenCount(100); // TODO: è®¡ç®—å®é™…tokenæ•°<br /><br />// å»ºè®®æ”¹è¿›<br />message.setTokenCount(tokenCalculator.calculateTokens(message.getContent()));<br />```<br /><br />2. <strong>å¼‚å¸¸å¤„ç†ä¸å¤Ÿå®Œå–„ï¼š</strong><br />```java<br />// å½“å‰æ‘˜è¦ç”Ÿæˆæ²¡æœ‰å¼‚å¸¸å¤„ç†<br />ChatResponse chatResponse = chatLanguageModel.chat(Arrays.asList(systemMessage, userMessage));<br /><br />// å»ºè®®å¢åŠ é‡è¯•æœºåˆ¶å’Œé™çº§ç­–ç•¥<br />```<br /><br />3. <strong>é…ç½®éªŒè¯ç¼ºå¤±ï¼š</strong><br />```java<br />// å»ºè®®å¢åŠ é…ç½®æ ¡éªŒ<br />public void validateConfig(TokenOverflowConfig config) {<br />    if (config.getMaxTokens() <= 0) {<br />        throw new IllegalArgumentException("maxTokens must be positive");<br />    }<br />    if (config.getSummaryThreshold() <= 0) {<br />        throw new IllegalArgumentException("summaryThreshold must be positive");<br />    }<br />}<br />```<br /><br /><h3>12. "å¦‚ä½•è®¾è®¡å•å…ƒæµ‹è¯•æ¥éªŒè¯ä¸åŒç­–ç•¥çš„æ­£ç¡®æ€§ï¼Ÿ"</h3><br /><br /><strong>åŸºäºç°æœ‰æµ‹è¯•çš„æ”¹è¿›ï¼š</strong><br /><br />```java<br />@SpringBootTest<br />public class TokenOverflowStrategyTest {<br />    <br />    @Test<br />    public void testSlidingWindowStrategy() {<br />        // 1. å‡†å¤‡æµ‹è¯•æ•°æ®<br />        List<TokenMessage> messages = createTestMessages(20, 100); // 20æ¡æ¶ˆæ¯ï¼Œæ¯æ¡100token<br />        TokenOverflowConfig config = new TokenOverflowConfig();<br />        config.setMaxTokens(1000);  // é™åˆ¶1000token<br />        config.setReserveRatio(0.1); // é¢„ç•™10%<br />        <br />        // 2. æ‰§è¡Œç­–ç•¥<br />        SlidingWindowTokenOverflowStrategy strategy = new SlidingWindowTokenOverflowStrategy(config);<br />        TokenProcessResult result = strategy.process(messages, config);<br />        <br />        // 3. éªŒè¯ç»“æœ<br />        assertThat(result.getRetainedMessages().size()).isLessThan(20);<br />        assertThat(calculateTotalTokens(result.getRetainedMessages())).isLessThanOrEqualTo(900);<br />        <br />        // 4. éªŒè¯ä¿ç•™çš„æ˜¯æœ€æ–°æ¶ˆæ¯<br />        List<TokenMessage> retained = result.getRetainedMessages();<br />        assertThat(retained.get(0).getCreatedAt()).isAfter(messages.get(0).getCreatedAt());<br />    }<br />    <br />    @Test<br />    public void testSummarizeStrategy() {<br />        // æµ‹è¯•æ‘˜è¦ç­–ç•¥çš„æ­£ç¡®æ€§<br />        // éªŒè¯æ‘˜è¦ç”Ÿæˆã€æ¶ˆæ¯ä¿ç•™ç­‰é€»è¾‘<br />    }<br />    <br />    @Test<br />    public void testEdgeCases() {<br />        // æµ‹è¯•è¾¹ç•Œæƒ…å†µï¼šç©ºæ¶ˆæ¯åˆ—è¡¨ã€å•æ¡è¶…é•¿æ¶ˆæ¯ç­‰<br />    }<br />}<br />```<br /><br /><h2>ğŸŒŸ å®é™…åº”ç”¨åœºæ™¯</h2><br /><br /><h3>13. "ä¸åŒç±»å‹çš„ Agent åº”è¯¥ä½¿ç”¨ä»€ä¹ˆç­–ç•¥ï¼Ÿ"</h3><br /><br /><strong>åŸºäº AgentX çš„ Agent ç±»å‹åˆ†æï¼š</strong><br /><br />```java<br />// åœ¨ AgentEntity ä¸­å¯ä»¥æ ¹æ® Agent ç±»å‹è®¾ç½®é»˜è®¤ç­–ç•¥<br />public class AgentRecommendationService {<br />    <br />    public TokenOverflowStrategyEnum recommendStrategy(AgentType agentType) {<br />        switch (agentType) {<br />            case CUSTOMER_SERVICE:<br />                // å®¢æœç±»ï¼šæ¯æ¬¡å¯¹è¯ç›¸å¯¹ç‹¬ç«‹ï¼Œä½¿ç”¨æ»‘åŠ¨çª—å£<br />                return TokenOverflowStrategyEnum.SLIDING_WINDOW;<br />                <br />            case PROGRAMMING_ASSISTANT:<br />                // ç¼–ç¨‹åŠ©æ‰‹ï¼šéœ€è¦è®°ä½ä»£ç ä¸Šä¸‹æ–‡ï¼Œä½¿ç”¨æ‘˜è¦ç­–ç•¥<br />                return TokenOverflowStrategyEnum.SUMMARIZE;<br />                <br />            case CREATIVE_WRITING:<br />                // åˆ›ä½œåŠ©æ‰‹ï¼šéœ€è¦ä¿æŒåˆ›ä½œè¿è´¯æ€§ï¼Œä½¿ç”¨æ‘˜è¦ç­–ç•¥<br />                return TokenOverflowStrategyEnum.SUMMARIZE;<br />                <br />            case QUICK_QA:<br />                // å¿«é€Ÿé—®ç­”ï¼šä¸éœ€è¦å¤æ‚ä¸Šä¸‹æ–‡ç®¡ç†<br />                return TokenOverflowStrategyEnum.NONE;<br />                <br />            default:<br />                return TokenOverflowStrategyEnum.SLIDING_WINDOW;<br />        }<br />    }<br />}<br />```<br /><br />è¿™äº›å›ç­”éƒ½åŸºäº AgentX é¡¹ç›®çš„å®é™…ä»£ç å®ç°ï¼Œå±•ç¤ºäº†å¯¹ç³»ç»Ÿæ¶æ„çš„æ·±å…¥ç†è§£ä»¥åŠå®é™…çš„æŠ€æœ¯å®ç°ç»†èŠ‚ã€‚åœ¨é¢è¯•ä¸­ï¼Œç»“åˆå…·ä½“ä»£ç æ¥å›ç­”é—®é¢˜ä¼šæ›´æœ‰è¯´æœåŠ›ã€‚</p>
            </main>
            
            <!-- æ–‡ç« åº•éƒ¨ -->
            <footer class="post-footer">
                <div class="post-actions">
                    <button class="back-button" onclick="history.back()">â† è¿”å›ä¸Šé¡µ</button>
                    <a href="../../blog.html" class="more-posts-link">æŸ¥çœ‹æ›´å¤šæ–‡ç«  â†’</a>
                </div>
                
                <!-- æ–‡ç« æ ‡ç­¾ -->
                <div class="post-tags">
                    <span class="tag-label">æ ‡ç­¾ï¼š</span>
                    <span class="tag">AIå·¥å…·</span>
                </div>
                
                <!-- ç‰ˆæƒä¿¡æ¯ -->
                <div class="post-copyright">
                    <p>æœ¬æ–‡ç”±æŠ€æœ¯åšå®¢åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚æ¬¢è¿åˆ†äº«ä¸äº¤æµï¼</p>
                </div>
            </footer>
        </article>
    </div>

    <!-- JavaScriptæ–‡ä»¶ -->
    <script src="../../scripts/highlight.js"></script>
    <script src="../../scripts/reading-toolbar.js"></script>
    <script src="../../scripts/table-of-contents.js"></script>
    
    <!-- é¡µé¢æ€§èƒ½ç›‘æ§ -->
    <script>
        // ç®€å•çš„é¡µé¢åŠ è½½æ€§èƒ½ç›‘æ§
        window.addEventListener('load', function() {
            const loadTime = window.performance.timing.loadEventEnd - window.performance.timing.navigationStart;
            console.log('é¡µé¢åŠ è½½æ—¶é—´:', loadTime + 'ms');
        });
    </script>
</body>
</html>