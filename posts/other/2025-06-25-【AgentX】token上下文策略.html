<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã€AgentXã€‘tokenä¸Šä¸‹æ–‡ç­–ç•¥ | Focusmee</title>
    <meta name="description" content="ã€AgentXã€‘tokenä¸Šä¸‹æ–‡ç­–ç•¥">
    <meta property="og:title" content="ã€AgentXã€‘tokenä¸Šä¸‹æ–‡ç­–ç•¥">
    <meta property="og:description" content="ã€AgentXã€‘tokenä¸Šä¸‹æ–‡ç­–ç•¥">
    <meta property="og:type" content="article">
    <link rel="stylesheet" href="../../styles/fonts.css">
    <link rel="stylesheet" href="../../styles/icons.css">
    <link rel="stylesheet" href="../../styles/highlight.css">
    <link rel="stylesheet" href="../../styles/main.css">
    <link rel="stylesheet" href="../../styles/post.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="../../index.html" class="logo-link">
                    <span class="logo-text">Focusmee</span>
                    <div class="logo-subtitle">å…¨æ ˆå¼€å‘å·¥ç¨‹å¸ˆ</div>
                </a>
            </div>
            <div class="nav-menu">
                <a href="../../index.html#about" class="nav-link">å…³äº</a>
                <a href="../../index.html#work" class="nav-link">é¡¹ç›®</a>
                <a href="../../blog.html" class="nav-link">åšå®¢</a>
                <a href="../../index.html#contact" class="nav-link">è”ç³»</a>
                <div class="nav-social">
                    <a href="https://github.com/Focusmee" target="_blank" class="social-link">
                        <i class="fab fa-github"></i>
                    </a>
                    <a href="mailto:2105735259@qq.com" class="social-link">
                        <i class="fas fa-envelope"></i>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Reading Toolbar -->
    <div id="readingToolbar" class="reading-toolbar">
        <div class="toolbar-handle">
            <i class="fas fa-bars"></i>
        </div>
        <div class="toolbar-content">
            <div class="toolbar-header">
                <h4>é˜…è¯»å·¥å…·</h4>
                <button class="toolbar-toggle" title="å±•å¼€/æ”¶èµ·">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
            <div class="toolbar-controls">
                <div class="control-group">
                    <label>å­—ä½“å¤§å°</label>
                    <div class="font-size-controls">
                        <button class="font-btn" data-action="decrease">A-</button>
                        <span class="font-size-display">16px</span>
                        <button class="font-btn" data-action="increase">A+</button>
                    </div>
                </div>
                <div class="control-group">
                    <label>ä¸»é¢˜æ¨¡å¼</label>
                    <button class="theme-toggle" id="themeToggle">
                        <i class="fas fa-moon"></i>
                        <span>æ·±è‰²æ¨¡å¼</span>
                    </button>
                </div>
                <div class="control-group">
                    <label>é˜…è¯»è¿›åº¦</label>
                    <div class="reading-progress-info">
                        <span id="readingPercentage">0%</span>
                        <div class="progress-bar-mini">
                            <div class="progress-fill-mini"></div>
                        </div>
                    </div>
                </div>
                <div class="control-group">
                    <button class="tool-btn" id="shareBtn">
                        <i class="fas fa-share-alt"></i>
                        <span>åˆ†äº«æ–‡ç« </span>
                    </button>
                </div>
                <div class="control-group">
                    <button class="tool-btn" id="printBtn">
                        <i class="fas fa-print"></i>
                        <span>æ‰“å°æ–‡ç« </span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Post Content -->
    <article class="post">
        <div class="container">
            <header class="post-header">
                <nav class="breadcrumb">
                    <a href="../../blog.html">åšå®¢</a>
                    <span class="separator">/</span>
                    <span class="category-breadcrumb">å…¶ä»–</span>
                    <span class="separator">/</span>
                    <span class="current">ã€AgentXã€‘tokenä¸Šä¸‹æ–‡ç­–ç•¥</span>
                </nav>
                
                <div class="post-meta">
                    <time class="post-date">2025/6/25 08:00:00</time>
                    <span class="post-category">å…¶ä»–</span>
                    <span class="post-read-time">25 åˆ†é’Ÿé˜…è¯»</span>
                </div>
                
                <h1 class="post-title">ã€AgentXã€‘tokenä¸Šä¸‹æ–‡ç­–ç•¥</h1>
                
                <div class="post-tags">
                    
                </div>
            </header>
            
            <div class="post-content">
                <h1>ã€AgentXã€‘tokenä¸Šä¸‹æ–‡ç­–ç•¥</h1>
<p>åŸºäº AgentX é¡¹ç›®çš„å®é™…ä»£ç å®ç°ï¼Œæˆ‘æ¥å›ç­”è¿™äº›é¢è¯•é—®é¢˜ï¼š</p>
<h2>ğŸ—ï¸ ç³»ç»Ÿè®¾è®¡ç±»é—®é¢˜</h2>
<h3>1. &quot;è¯·è®¾è®¡ä¸€ä¸ªæ”¯æŒå¤šç§ Token ç®¡ç†ç­–ç•¥çš„å¯æ‰©å±•æ¶æ„&quot;</h3>
<p><strong>åŸºäº AgentX çš„å›ç­”ï¼š</strong></p>
<p>AgentX é‡‡ç”¨äº†ç­–ç•¥æ¨¡å¼ + å·¥å‚æ¨¡å¼çš„ç»å…¸æ¶æ„ï¼š</p>
<pre><code class="language-java">// ç­–ç•¥æ¥å£
public interface TokenOverflowStrategy {
    TokenProcessResult process(List&lt;TokenMessage&gt; messages, TokenOverflowConfig config);
    String getName();
    boolean needsProcessing(List&lt;TokenMessage&gt; messages);
}

// å·¥å‚ç±»è´Ÿè´£åˆ›å»ºç­–ç•¥å®ä¾‹
@Service
public class TokenOverflowStrategyFactory {
    public static TokenOverflowStrategy createStrategy(
        TokenOverflowStrategyEnum strategyType, 
        TokenOverflowConfig config) {
        switch (strategyType) {
            case SLIDING_WINDOW: return new SlidingWindowTokenOverflowStrategy(config);
            case SUMMARIZE: return new SummarizeTokenOverflowStrategy(config);
            case NONE: 
            default: return new NoTokenOverflowStrategy();
        }
    }
}
</code></pre>
<p><strong>æ¶æ„ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li><strong>å¯æ‰©å±•æ€§</strong>ï¼šæ–°å¢ç­–ç•¥åªéœ€å®ç° <code>TokenOverflowStrategy</code> æ¥å£</li>
<li><strong>é…ç½®é©±åŠ¨</strong>ï¼šé€šè¿‡ <code>TokenOverflowConfig</code> ç»Ÿä¸€ç®¡ç†ç­–ç•¥å‚æ•°</li>
<li><strong>è§£è€¦åˆ</strong>ï¼šç­–ç•¥å®ç°ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»</li>
</ul>
<h3>2. &quot;å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å¹¶å‘åœºæ™¯ä¸‹çš„ä¸Šä¸‹æ–‡ç®¡ç†ç³»ç»Ÿï¼Ÿ&quot;</h3>
<p><strong>AgentX çš„å¹¶å‘å¤„ç†è®¾è®¡ï¼š</strong></p>
<pre><code class="language-java">// ä¸Šä¸‹æ–‡å¤„ç†å™¨ä½¿ç”¨ Spring ç®¡ç†å¹¶å‘
@Service
public class ContextProcessor {
    // é€šè¿‡ä¾èµ–æ³¨å…¥ä¿è¯çº¿ç¨‹å®‰å…¨
    private final ContextDomainService contextDomainService;
    private final MessageDomainService messageDomainService;
    private final TokenDomainService tokenDomainService;
    
    // æ¯ä¸ªä¼šè¯ç‹¬ç«‹å¤„ç†ï¼Œé¿å…å…±äº«çŠ¶æ€
    public ContextResult processContext(String sessionId, ...) {
        ContextEntity contextEntity = contextDomainService.findBySessionId(sessionId);
        // åŸºäº sessionId éš”ç¦»ï¼Œå¤©ç„¶æ”¯æŒå¹¶å‘
    }
}
</code></pre>
<p><strong>å¹¶å‘å®‰å…¨ä¿è¯ï¼š</strong></p>
<ul>
<li><strong>æ— çŠ¶æ€è®¾è®¡</strong>ï¼šç­–ç•¥ç±»ä¸ç»´æŠ¤çŠ¶æ€ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½æ˜¯ç‹¬ç«‹çš„</li>
<li><strong>ä¼šè¯éš”ç¦»</strong>ï¼šåŸºäº <code>sessionId</code> è¿›è¡Œæ•°æ®éš”ç¦»</li>
<li><strong>äº‹åŠ¡ç®¡ç†</strong>ï¼šä½¿ç”¨ <code>@Transactional</code> ä¿è¯æ•°æ®ä¸€è‡´æ€§</li>
</ul>
<h2>ğŸ”§ ç®—æ³•å’ŒæŠ€æœ¯å®ç°ç±»é—®é¢˜</h2>
<h3>3. &quot;å¦‚ä½•ç²¾ç¡®è®¡ç®—ä¸åŒæ¨¡å‹çš„ Token æ•°é‡ï¼Ÿ&quot;</h3>
<p><strong>AgentX çš„ Token è®¡ç®—å®ç°ï¼š</strong></p>
<pre><code class="language-java">// å½“å‰å®ç°ä¸­ï¼ŒToken æ•°é‡å­˜å‚¨åœ¨ TokenMessage ä¸­
public class TokenMessage {
    private Integer tokenCount; // é¢„è®¡ç®—çš„ token æ•°é‡
    
    // åœ¨æ¶ˆæ¯åˆ›å»ºæ—¶è®¡ç®—å¹¶ç¼“å­˜
    public void setTokenCount(Integer tokenCount) {
        this.tokenCount = tokenCount;
    }
}

// æ»‘åŠ¨çª—å£ç­–ç•¥ä¸­çš„ Token è®¡ç®—
private int calculateTotalTokens(List&lt;TokenMessage&gt; messages) {
    return messages.stream()
        .mapToInt(m -&gt; m.getTokenCount() != null ? m.getTokenCount() : 0)
        .sum();
}
</code></pre>
<p><strong>æŒ‘æˆ˜å’Œè§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li><strong>æ¨¡å‹å·®å¼‚æ€§</strong>ï¼šä¸åŒæ¨¡å‹æœ‰ä¸åŒçš„ tokenizerï¼Œéœ€è¦é€‚é…</li>
<li><strong>è®¡ç®—æ€§èƒ½</strong>ï¼šAgentX é‡‡ç”¨é¢„è®¡ç®— + ç¼“å­˜çš„æ–¹å¼é¿å…é‡å¤è®¡ç®—</li>
<li><strong>å‡†ç¡®æ€§ä¿è¯</strong>ï¼šå»ºè®®é›†æˆå…·ä½“æ¨¡å‹çš„ tokenizer åº“</li>
</ul>
<h3>4. &quot;æ‘˜è¦ç®—æ³•å¦‚ä½•ä¿è¯ä¸ä¸¢å¤±å…³é”®ä¿¡æ¯ï¼Ÿ&quot;</h3>
<p><strong>AgentX çš„æ‘˜è¦å®ç°åˆ†æï¼š</strong></p>
<pre><code class="language-java">private String generateSummary(List&lt;TokenMessage&gt; messages, TokenOverflowConfig config) {
    // ä½¿ç”¨ä¸“é—¨çš„æ‘˜è¦æç¤ºè¯
    SystemMessage systemMessage = new SystemMessage(
        &quot;ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å¯¹è¯æ‘˜è¦ç”Ÿæˆå™¨ï¼Œè¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹è¦æ±‚å·¥ä½œï¼š\n&quot; +
        &quot;1. åªåŸºäºæä¾›çš„å¯¹è¯å†…å®¹ç”Ÿæˆå®¢è§‚æ‘˜è¦ï¼Œä¸å¾—æ·»åŠ ä»»ä½•åŸå¯¹è¯ä¸­æ²¡æœ‰çš„ä¿¡æ¯\n&quot; +
        &quot;2. ç‰¹åˆ«å…³æ³¨ï¼šç”¨æˆ·é—®é¢˜ã€å›ç­”ä¸­çš„å…³é”®ä¿¡æ¯ã€é‡è¦äº‹å®\n&quot; +
        &quot;3. å»é™¤æ‰€æœ‰å¯’æš„ã€è¡¨æƒ…ç¬¦å·å’Œæƒ…æ„Ÿè¡¨è¾¾\n&quot; +
        &quot;4. ä½¿ç”¨ç®€æ´çš„ç¬¬ä¸‰äººç§°é™ˆè¿°å¥\n&quot; +
        &quot;5. ä¿æŒæ—¶é—´é¡ºåºå’Œé€»è¾‘å…³ç³»\n&quot; +
        &quot;6. ç¤ºä¾‹æ ¼å¼ï¼š[ç”¨æˆ·]é—®... [AI]å›ç­”...\n&quot;
    );
}
</code></pre>
<p><strong>è´¨é‡ä¿è¯æœºåˆ¶ï¼š</strong></p>
<ul>
<li><strong>ç»“æ„åŒ–æç¤ºè¯</strong>ï¼šæ˜ç¡®æŒ‡å¯¼æ‘˜è¦ç”Ÿæˆçš„è§„åˆ™</li>
<li><strong>é‡è¦ä¿¡æ¯æ ‡è¯†</strong>ï¼šç‰¹åˆ«å…³æ³¨ç”¨æˆ·é—®é¢˜å’Œå…³é”®å›ç­”</li>
<li><strong>æ ¼å¼è§„èŒƒ</strong>ï¼šä½¿ç”¨ç»Ÿä¸€çš„æ‘˜è¦æ ¼å¼ä¾¿äºåç»­å¤„ç†</li>
</ul>
<h2>ğŸ“Š æ€§èƒ½å’Œå¹¶å‘é—®é¢˜</h2>
<h3>5. &quot;åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¦‚ä½•ä¼˜åŒ– Token è®¡ç®—çš„æ€§èƒ½ï¼Ÿ&quot;</h3>
<p><strong>AgentX çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼š</strong></p>
<pre><code class="language-java">// 1. é¢„è®¡ç®— Token æ•°é‡ï¼Œé¿å…å®æ—¶è®¡ç®—
public class TokenMessage {
    private Integer tokenCount; // æ¶ˆæ¯åˆ›å»ºæ—¶å°±è®¡ç®—å¥½
}

// 2. æ‰¹é‡å¤„ç†æ¶ˆæ¯
public TokenProcessResult process(List&lt;TokenMessage&gt; messages, TokenOverflowConfig config) {
    // ä¸€æ¬¡æ€§å¤„ç†æ•´ä¸ªæ¶ˆæ¯åˆ—è¡¨ï¼Œå‡å°‘æ•°æ®åº“è®¿é—®
    int totalTokens = calculateTotalTokens(messages);
}

// 3. é…ç½®ç¼“å­˜é¿å…é‡å¤åˆ›å»ºç­–ç•¥å¯¹è±¡
@Service
public class TokenOverflowStrategyFactory {
    // å¯ä»¥å¢åŠ ç­–ç•¥å®ä¾‹ç¼“å­˜
}
</code></pre>
<h3>6. &quot;æ‘˜è¦ç”Ÿæˆæ˜¯ I/O å¯†é›†å‹æ“ä½œï¼Œå¦‚ä½•è®¾è®¡å¼‚æ­¥å¤„ç†ï¼Ÿ&quot;</h3>
<p><strong>å½“å‰åŒæ­¥å®ç°çš„é—®é¢˜ï¼š</strong></p>
<pre><code class="language-java">// å½“å‰å®ç°æ˜¯åŒæ­¥çš„ï¼Œä¼šé˜»å¡ç”¨æˆ·è¯·æ±‚
String summary = generateSummary(messagesToSummarize, tokenOverflowConfig);
</code></pre>
<p><strong>å»ºè®®çš„å¼‚æ­¥ä¼˜åŒ–ï¼š</strong></p>
<pre><code class="language-java">// å¯ä»¥è®¾è®¡å¼‚æ­¥æ‘˜è¦ç”Ÿæˆ
@Async(&quot;summaryExecutor&quot;)
public CompletableFuture&lt;String&gt; generateSummaryAsync(List&lt;TokenMessage&gt; messages) {
    // å¼‚æ­¥ç”Ÿæˆæ‘˜è¦ï¼Œç”¨æˆ·è¯·æ±‚ä¸è¢«é˜»å¡
    // å¯ä»¥å…ˆè¿”å›ä¸´æ—¶çš„æ»‘åŠ¨çª—å£ç»“æœï¼Œæ‘˜è¦å®Œæˆåå†æ›´æ–°
}
</code></pre>
<h2>ğŸ¯ ä¸šåŠ¡é€»è¾‘å’Œè¾¹ç•Œæƒ…å†µ</h2>
<h3>7. &quot;åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹åº”è¯¥é€‰æ‹©æ»‘åŠ¨çª—å£ vs æ‘˜è¦ç­–ç•¥ï¼Ÿ&quot;</h3>
<p><strong>åŸºäº AgentX ä»£ç çš„åˆ†æï¼š</strong></p>
<pre><code class="language-java">// æ»‘åŠ¨çª—å£ç­–ç•¥ - é€‚åˆç®€å•å¯¹è¯
public class SlidingWindowTokenOverflowStrategy {
    // ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œæ— éœ€é¢å¤–LLMè°ƒç”¨ï¼Œå»¶è¿Ÿä½
    // ç¼ºç‚¹ï¼šå†å²ä¿¡æ¯å®Œå…¨ä¸¢å¤±
    // é€‚ç”¨ï¼šé—®ç­”ç±»ã€ä¸éœ€è¦é•¿æœŸè®°å¿†çš„åœºæ™¯
}

// æ‘˜è¦ç­–ç•¥ - é€‚åˆå¤æ‚å¯¹è¯
public class SummarizeTokenOverflowStrategy {
    // ä¼˜ç‚¹ï¼šä¿ç•™å…³é”®å†å²ä¿¡æ¯
    // ç¼ºç‚¹ï¼šéœ€è¦é¢å¤–LLMè°ƒç”¨ï¼Œæœ‰å»¶è¿Ÿå’Œæˆæœ¬
    // é€‚ç”¨ï¼šéœ€è¦ä¸Šä¸‹æ–‡è¿è´¯æ€§çš„å¤æ‚å¯¹è¯
}
</code></pre>
<p><strong>é€‰æ‹©ç­–ç•¥ï¼š</strong></p>
<ul>
<li><strong>å®¢æœåœºæ™¯</strong>ï¼šæ»‘åŠ¨çª—å£ï¼ˆæ¯æ¬¡å¯¹è¯ç›¸å¯¹ç‹¬ç«‹ï¼‰</li>
<li><strong>ç¼–ç¨‹åŠ©æ‰‹</strong>ï¼šæ‘˜è¦ç­–ç•¥ï¼ˆéœ€è¦è®°ä½ä¹‹å‰çš„ä»£ç ä¸Šä¸‹æ–‡ï¼‰</li>
<li><strong>åˆ›ä½œåŠ©æ‰‹</strong>ï¼šæ‘˜è¦ç­–ç•¥ï¼ˆéœ€è¦ä¿æŒåˆ›ä½œè¿è´¯æ€§ï¼‰</li>
</ul>
<h3>8. &quot;å¦‚æœå•æ¡æ¶ˆæ¯å°±è¶…è¿‡æ¨¡å‹ä¸Šä¸‹æ–‡é™åˆ¶æ€ä¹ˆåŠï¼Ÿ&quot;</h3>
<p><strong>AgentX å½“å‰å®ç°çš„ä¸è¶³ï¼š</strong></p>
<pre><code class="language-java">// å½“å‰ä»£ç æ²¡æœ‰å¤„ç†å•æ¡æ¶ˆæ¯è¿‡é•¿çš„æƒ…å†µ
private int calculateTotalTokens(List&lt;TokenMessage&gt; messages) {
    return messages.stream().mapToInt(m -&gt; m.getTokenCount() != null ? m.getTokenCount() : 0).sum();
}
</code></pre>
<p><strong>å»ºè®®çš„å¤„ç†æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="language-java">public class MessageSplitter {
    // å¯¹è¶…é•¿æ¶ˆæ¯è¿›è¡Œæ™ºèƒ½åˆ†å‰²
    public List&lt;TokenMessage&gt; splitLongMessage(TokenMessage longMessage, int maxTokens) {
        // æŒ‰æ®µè½ã€å¥å­è¾¹ç•Œè¿›è¡Œåˆ†å‰²
        // ä¿æŒè¯­ä¹‰å®Œæ•´æ€§
    }
}
</code></pre>
<h2>ğŸ” æ•°æ®ä¸€è‡´æ€§å’Œå¯é æ€§</h2>
<h3>9. &quot;ä¸Šä¸‹æ–‡æ›´æ–°å’Œæ¶ˆæ¯ä¿å­˜å¦‚ä½•ä¿è¯äº‹åŠ¡ä¸€è‡´æ€§ï¼Ÿ&quot;</h3>
<p><strong>AgentX çš„äº‹åŠ¡ç®¡ç†ï¼š</strong></p>
<pre><code class="language-java">@Service
public class ChatCompletionHandlerImpl implements ChatCompletionHandler {
    
    @Override
    @Transactional  // ä½¿ç”¨äº‹åŠ¡ä¿è¯ä¸€è‡´æ€§
    public void handleCompletion(MessageEntity userMessage, MessageEntity llmMessage, 
                                ContextEntity contextEntity, ...) {
        try {
            // 1. ä¿å­˜æ¶ˆæ¯
            List&lt;MessageEntity&gt; messages = Arrays.asList(userMessage, llmMessage);
            conversationDomainService.saveMessages(messages);
            
            // 2. æ›´æ–°ä¸Šä¸‹æ–‡
            contextDomainService.updateContext(contextEntity);
        } catch (Exception e) {
            // äº‹åŠ¡å›æ»šï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§
            throw new BusinessException(&quot;èŠå¤©å®Œæˆå¤„ç†å¤±è´¥&quot;, e);
        }
    }
}
</code></pre>
<h3>10. &quot;å¦‚ä½•è®¾è®¡ç›‘æ§æŒ‡æ ‡æ¥è¯„ä¼° Token ç®¡ç†ç­–ç•¥çš„æ•ˆæœï¼Ÿ&quot;</h3>
<p><strong>åŸºäº AgentX å¯ä»¥å¢åŠ çš„ç›‘æ§æŒ‡æ ‡ï¼š</strong></p>
<pre><code class="language-java">@Component
public class TokenManagementMetrics {
    
    // 1. ç­–ç•¥ä½¿ç”¨ç»Ÿè®¡
    public void recordStrategyUsage(String sessionId, TokenOverflowStrategyEnum strategy) {
        // ç»Ÿè®¡å„ç§ç­–ç•¥çš„ä½¿ç”¨é¢‘ç‡
    }
    
    // 2. Token èŠ‚çœæ•ˆæœ
    public void recordTokenSavings(String sessionId, int originalTokens, int processedTokens) {
        double savingRatio = (originalTokens - processedTokens) / (double) originalTokens;
        // è®°å½• Token èŠ‚çœæ¯”ä¾‹
    }
    
    // 3. æ‘˜è¦è´¨é‡è¯„ä¼°
    public void recordSummaryMetrics(String sessionId, int originalMessages, int summaryTokens) {
        // è®°å½•æ‘˜è¦å‹ç¼©æ¯”ä¾‹
    }
    
    // 4. ç”¨æˆ·ä½“éªŒæŒ‡æ ‡
    public void recordUserSatisfaction(String sessionId, boolean contextLoss) {
        // è®°å½•ç”¨æˆ·æ˜¯å¦æ„Ÿå—åˆ°ä¸Šä¸‹æ–‡ä¸¢å¤±
    }
}
</code></pre>
<h2>ğŸ’¡ ä»£ç è´¨é‡å’Œæœ€ä½³å®è·µ</h2>
<h3>11. &quot;å½“å‰ä»£ç ä¸­ä½ çœ‹åˆ°å“ªäº›å¯ä»¥æ”¹è¿›çš„åœ°æ–¹ï¼Ÿ&quot;</h3>
<p><strong>åŸºäºä»£ç åˆ†æçš„æ”¹è¿›å»ºè®®ï¼š</strong></p>
<ol>
<li><strong>ç¡¬ç¼–ç é—®é¢˜ï¼š</strong></li>
</ol>
<pre><code class="language-java">// å½“å‰ä»£ç ä¸­çš„ç¡¬ç¼–ç 
message.setTokenCount(100); // TODO: è®¡ç®—å®é™…tokenæ•°

// å»ºè®®æ”¹è¿›
message.setTokenCount(tokenCalculator.calculateTokens(message.getContent()));
</code></pre>
<ol start="2">
<li><strong>å¼‚å¸¸å¤„ç†ä¸å¤Ÿå®Œå–„ï¼š</strong></li>
</ol>
<pre><code class="language-java">// å½“å‰æ‘˜è¦ç”Ÿæˆæ²¡æœ‰å¼‚å¸¸å¤„ç†
ChatResponse chatResponse = chatLanguageModel.chat(Arrays.asList(systemMessage, userMessage));

// å»ºè®®å¢åŠ é‡è¯•æœºåˆ¶å’Œé™çº§ç­–ç•¥
</code></pre>
<ol start="3">
<li><strong>é…ç½®éªŒè¯ç¼ºå¤±ï¼š</strong></li>
</ol>
<pre><code class="language-java">// å»ºè®®å¢åŠ é…ç½®æ ¡éªŒ
public void validateConfig(TokenOverflowConfig config) {
    if (config.getMaxTokens() &lt;= 0) {
        throw new IllegalArgumentException(&quot;maxTokens must be positive&quot;);
    }
    if (config.getSummaryThreshold() &lt;= 0) {
        throw new IllegalArgumentException(&quot;summaryThreshold must be positive&quot;);
    }
}
</code></pre>
<h3>12. &quot;å¦‚ä½•è®¾è®¡å•å…ƒæµ‹è¯•æ¥éªŒè¯ä¸åŒç­–ç•¥çš„æ­£ç¡®æ€§ï¼Ÿ&quot;</h3>
<p><strong>åŸºäºç°æœ‰æµ‹è¯•çš„æ”¹è¿›ï¼š</strong></p>
<pre><code class="language-java">@SpringBootTest
public class TokenOverflowStrategyTest {
    
    @Test
    public void testSlidingWindowStrategy() {
        // 1. å‡†å¤‡æµ‹è¯•æ•°æ®
        List&lt;TokenMessage&gt; messages = createTestMessages(20, 100); // 20æ¡æ¶ˆæ¯ï¼Œæ¯æ¡100token
        TokenOverflowConfig config = new TokenOverflowConfig();
        config.setMaxTokens(1000);  // é™åˆ¶1000token
        config.setReserveRatio(0.1); // é¢„ç•™10%
        
        // 2. æ‰§è¡Œç­–ç•¥
        SlidingWindowTokenOverflowStrategy strategy = new SlidingWindowTokenOverflowStrategy(config);
        TokenProcessResult result = strategy.process(messages, config);
        
        // 3. éªŒè¯ç»“æœ
        assertThat(result.getRetainedMessages().size()).isLessThan(20);
        assertThat(calculateTotalTokens(result.getRetainedMessages())).isLessThanOrEqualTo(900);
        
        // 4. éªŒè¯ä¿ç•™çš„æ˜¯æœ€æ–°æ¶ˆæ¯
        List&lt;TokenMessage&gt; retained = result.getRetainedMessages();
        assertThat(retained.get(0).getCreatedAt()).isAfter(messages.get(0).getCreatedAt());
    }
    
    @Test
    public void testSummarizeStrategy() {
        // æµ‹è¯•æ‘˜è¦ç­–ç•¥çš„æ­£ç¡®æ€§
        // éªŒè¯æ‘˜è¦ç”Ÿæˆã€æ¶ˆæ¯ä¿ç•™ç­‰é€»è¾‘
    }
    
    @Test
    public void testEdgeCases() {
        // æµ‹è¯•è¾¹ç•Œæƒ…å†µï¼šç©ºæ¶ˆæ¯åˆ—è¡¨ã€å•æ¡è¶…é•¿æ¶ˆæ¯ç­‰
    }
}
</code></pre>
<h2>ğŸŒŸ å®é™…åº”ç”¨åœºæ™¯</h2>
<h3>13. &quot;ä¸åŒç±»å‹çš„ Agent åº”è¯¥ä½¿ç”¨ä»€ä¹ˆç­–ç•¥ï¼Ÿ&quot;</h3>
<p><strong>åŸºäº AgentX çš„ Agent ç±»å‹åˆ†æï¼š</strong></p>
<pre><code class="language-java">// åœ¨ AgentEntity ä¸­å¯ä»¥æ ¹æ® Agent ç±»å‹è®¾ç½®é»˜è®¤ç­–ç•¥
public class AgentRecommendationService {
    
    public TokenOverflowStrategyEnum recommendStrategy(AgentType agentType) {
        switch (agentType) {
            case CUSTOMER_SERVICE:
                // å®¢æœç±»ï¼šæ¯æ¬¡å¯¹è¯ç›¸å¯¹ç‹¬ç«‹ï¼Œä½¿ç”¨æ»‘åŠ¨çª—å£
                return TokenOverflowStrategyEnum.SLIDING_WINDOW;
                
            case PROGRAMMING_ASSISTANT:
                // ç¼–ç¨‹åŠ©æ‰‹ï¼šéœ€è¦è®°ä½ä»£ç ä¸Šä¸‹æ–‡ï¼Œä½¿ç”¨æ‘˜è¦ç­–ç•¥
                return TokenOverflowStrategyEnum.SUMMARIZE;
                
            case CREATIVE_WRITING:
                // åˆ›ä½œåŠ©æ‰‹ï¼šéœ€è¦ä¿æŒåˆ›ä½œè¿è´¯æ€§ï¼Œä½¿ç”¨æ‘˜è¦ç­–ç•¥
                return TokenOverflowStrategyEnum.SUMMARIZE;
                
            case QUICK_QA:
                // å¿«é€Ÿé—®ç­”ï¼šä¸éœ€è¦å¤æ‚ä¸Šä¸‹æ–‡ç®¡ç†
                return TokenOverflowStrategyEnum.NONE;
                
            default:
                return TokenOverflowStrategyEnum.SLIDING_WINDOW;
        }
    }
}
</code></pre>
<p>è¿™äº›å›ç­”éƒ½åŸºäº AgentX é¡¹ç›®çš„å®é™…ä»£ç å®ç°ï¼Œå±•ç¤ºäº†å¯¹ç³»ç»Ÿæ¶æ„çš„æ·±å…¥ç†è§£ä»¥åŠå®é™…çš„æŠ€æœ¯å®ç°ç»†èŠ‚ã€‚åœ¨é¢è¯•ä¸­ï¼Œç»“åˆå…·ä½“ä»£ç æ¥å›ç­”é—®é¢˜ä¼šæ›´æœ‰è¯´æœåŠ›ã€‚</p>

            </div>
        </div>
    </article>

    <script src="../../scripts/highlight.js"></script>
    <script src="../../scripts/post-enhance.js"></script>
    <script src="../../scripts/reading-toolbar.js"></script>
</body>
</html>