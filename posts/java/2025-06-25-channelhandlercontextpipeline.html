<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChannelHandlerContextå’ŒPipeline - æŠ€æœ¯åšå®¢</title>
    <meta name="description" content="ChannelHandlerContextå’ŒPipeline - Javaç›¸å…³æŠ€æœ¯æ–‡ç« ">
    <meta name="keywords" content="Java, æŠ€æœ¯åšå®¢, ç¼–ç¨‹, å¼€å‘">
    
    <!-- CSSæ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="../../styles/main.css">
    <link rel="stylesheet" href="../../styles/post.css">
    <link rel="stylesheet" href="../../styles/highlight.css">
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="../../index.html" class="nav-brand">ğŸ“š æŠ€æœ¯åšå®¢</a>
            <div class="nav-links">
                <a href="../../index.html" class="nav-link">é¦–é¡µ</a>
                <a href="../../blog.html" class="nav-link">åšå®¢</a>
            </div>
        </div>
    </nav>

    <!-- é¢åŒ…å±‘å¯¼èˆª -->
    <div class="breadcrumb">
        <div class="container">
            <a href="../../index.html">é¦–é¡µ</a>
            <span class="separator">â€º</span>
            <a href="../../blog.html">åšå®¢</a>
            <span class="separator">â€º</span>
            <span class="category-breadcrumb">Java</span>
            <span class="separator">â€º</span>
            <span class="current-page">ChannelHandlerContextå’ŒPipeline</span>
        </div>
    </div>

    <!-- æ–‡ç« å®¹å™¨ - ç›®å½•åŠŸèƒ½ä¼šåœ¨è¿™é‡ŒåŠ¨æ€æ’å…¥ -->
    <div class="container">
        <article class="post-container">
            <!-- æ–‡ç« å¤´éƒ¨ -->
            <header class="post-header">
                <div class="post-meta">
                    <span class="category-tag java">â˜• Java</span>
                    <time class="publish-date" datetime="2025-06-25">2025-06-25</time>
                    <span class="read-time">ğŸ“– 5 åˆ†é’Ÿé˜…è¯»</span>
                </div>
                <h1 class="post-title">ChannelHandlerContextå’ŒPipeline</h1>
            </header>
            
            <!-- æ–‡ç« å†…å®¹ -->
            <main class="post-content">
                <p><h1>Netty ChannelHandlerContext å’Œ Pipeline ä½œç”¨</h1><br />_Exported on 2025/6/10 at GMT+8 16:13:31 from Cursor (1.0.0)_</p><p>---</p><p><strong>User</strong></p><p>èƒ½åˆ—ä¸¾è¯´æ˜æ‰€æœ‰Nettyä¸­ChannelHandlerContextçš„æ¥å£ä½œç”¨handleræ„æˆçš„Pipelineié“¾è·¯çš„æ•ˆæœå—</p><p>---</p><p><strong>Cursor</strong></p><p>æˆ‘æ¥å¸®æ‚¨è¯¦ç»†åˆ†æNettyä¸­ChannelHandlerContextçš„æ¥å£ä½œç”¨å’ŒPipelineé“¾è·¯æ•ˆæœã€‚é¦–å…ˆè®©æˆ‘æŸ¥çœ‹ä¸€ä¸‹æ‚¨é¡¹ç›®ä¸­çš„Nettyç›¸å…³ä»£ç ã€‚</p><p>åŸºäºæ‚¨é¡¹ç›®ä¸­çš„ä»£ç ç¤ºä¾‹ï¼Œæˆ‘æ¥è¯¦ç»†è¯´æ˜Nettyä¸­ChannelHandlerContextçš„æ¥å£ä½œç”¨ä»¥åŠHandleræ„æˆçš„Pipelineé“¾è·¯æ•ˆæœï¼š</p><p><h2>ChannelHandlerContextæ ¸å¿ƒæ¥å£ä½œç”¨</h2></p><p><h3>1. äº‹ä»¶ä¼ æ’­æ¥å£</h3><br />ChannelHandlerContextæ˜¯Handlerä¹‹é—´çš„æ¡¥æ¢ï¼Œæä¾›äº†å…³é”®çš„äº‹ä»¶ä¼ æ’­æ–¹æ³•ï¼š</p><p><strong>å…¥ç«™äº‹ä»¶ä¼ æ’­ï¼ˆInboundï¼‰ï¼š</strong><br />- `fireChannelRegistered()` - ä¼ æ’­Channelæ³¨å†Œäº‹ä»¶<br />- `fireChannelActive()` - ä¼ æ’­è¿æ¥æ¿€æ´»äº‹ä»¶<br />- `fireChannelRead(Object msg)` - ä¼ æ’­æ•°æ®è¯»å–äº‹ä»¶<br />- `fireChannelReadComplete()` - ä¼ æ’­è¯»å–å®Œæˆäº‹ä»¶<br />- `fireChannelInactive()` - ä¼ æ’­è¿æ¥æ–­å¼€äº‹ä»¶<br />- `fireExceptionCaught(Throwable cause)` - ä¼ æ’­å¼‚å¸¸äº‹ä»¶</p><p><strong>å‡ºç«™æ“ä½œæ¥å£ï¼ˆOutboundï¼‰ï¼š</strong><br />- `write(Object msg)` - å†™å…¥æ•°æ®åˆ°ç¼“å†²åŒº<br />- `writeAndFlush(Object msg)` - å†™å…¥å¹¶ç«‹å³å‘é€<br />- `flush()` - åˆ·æ–°ç¼“å†²åŒº<br />- `close()` - å…³é—­è¿æ¥<br />- `connect()` - å»ºç«‹è¿æ¥</p><p><h3>2. ä¸Šä¸‹æ–‡è®¿é—®æ¥å£</h3><br />- `channel()` - è·å–å…³è”çš„Channel<br />- `pipeline()` - è·å–Pipelineå¼•ç”¨<br />- `handler()` - è·å–å½“å‰Handler<br />- `name()` - è·å–Handleråç§°<br />- `executor()` - è·å–æ‰§è¡Œå™¨</p><p><h2>Pipelineé“¾è·¯å·¥ä½œæ•ˆæœ</h2></p><p><h3>1. Handleræ‰§è¡Œé¡ºåº</h3></p><p>æ ¹æ®æ‚¨é¡¹ç›®ä¸­çš„ `PipelineServer.java` ç¤ºä¾‹ï¼š</p><p>```java<br />// Pipelineé…ç½®é¡ºåº<br />pipeline.addLast("decoder", new StringDecoder(CharsetUtil.UTF_8));<br />pipeline.addLast("inbound1", new InboundHandler1());<br />pipeline.addLast("inbound2", new InboundHandler2());<br />pipeline.addLast("business", new BusinessHandler());<br />pipeline.addLast("outbound1", new OutboundHandler1());<br />pipeline.addLast("outbound2", new OutboundHandler2());<br />pipeline.addLast("encoder", new StringEncoder(CharsetUtil.UTF_8));<br />```</p><p><strong>å…¥ç«™äº‹ä»¶æµï¼ˆæ•°æ®æ¥æ”¶ï¼‰ï¼š</strong><br />```<br />Socketæ•°æ® â†’ decoder â†’ inbound1 â†’ inbound2 â†’ business â†’ ä¸šåŠ¡å¤„ç†<br />```</p><p><strong>å‡ºç«™äº‹ä»¶æµï¼ˆæ•°æ®å‘é€ï¼‰ï¼š</strong><br />```<br />ä¸šåŠ¡å¤„ç† â†’ outbound2 â†’ outbound1 â†’ encoder â†’ Socketå‘é€<br />```</p><p><h3>2. ä¸¤ç§ä¼ æ’­æ–¹å¼çš„åŒºåˆ«</h3></p><p>ä»æ‚¨é¡¹ç›®çš„ `BusinessHandler.java` ä¸­å¯ä»¥çœ‹åˆ°ï¼š</p><p>```java<br />// æ–¹å¼1ï¼šä»å½“å‰ä½ç½®å¼€å§‹çš„Outboundé“¾<br />ctx.writeAndFlush(response);</p><p>// æ–¹å¼2ï¼šä»Pipelineå°¾éƒ¨å¼€å§‹çš„å®Œæ•´Outboundé“¾<br />ctx.channel().writeAndFlush(response);<br />```</p><p><strong>ctx.writeAndFlush()æ•ˆæœï¼š</strong><br />- ä»å½“å‰Handlerä½ç½®å‘å‰ä¼ æ’­<br />- è·³è¿‡å‰é¢çš„OutboundHandler<br />- æ•ˆç‡æ›´é«˜ï¼Œä½†å¯èƒ½é”™è¿‡æŸäº›å¤„ç†</p><p><strong>ctx.channel().writeAndFlush()æ•ˆæœï¼š</strong><br />- ä»Pipelineå°¾éƒ¨å¼€å§‹å®Œæ•´ä¼ æ’­<br />- ç»è¿‡æ‰€æœ‰OutboundHandler<br />- ä¿è¯å®Œæ•´çš„å¤„ç†é“¾è·¯</p><p><h3>3. å®é™…è¿è¡Œæ•ˆæœæ¼”ç¤º</h3></p><p>æ ¹æ®æ‚¨é¡¹ç›®çš„ `NettyWorkflowDemo.java`ï¼Œå½“å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯æ—¶ï¼š</p><p>```java<br />@Override<br />public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception {<br />    System.out.println("\n=== æœåŠ¡å™¨ç«¯äº‹ä»¶: channelRead (InboundHandler) ===");<br />    System.out.println("   æ¶ˆæ¯ç»è¿‡çš„Handler: decoder -> serverHandler");<br />    <br />    String response = "Echo: " + msg;<br />    ctx.writeAndFlush(response);<br />    System.out.println("   å“åº”å°†ç»è¿‡çš„Handler: serverHandler -> encoder");<br />}<br />```</p><p><h3>4. çº¿ç¨‹æ¨¡å‹æ•ˆæœ</h3></p><p>Pipelineä¸­çš„æ‰€æœ‰Handleréƒ½åœ¨åŒä¸€ä¸ªEventLoopçº¿ç¨‹ä¸­æ‰§è¡Œï¼š<br />- <strong>å•çº¿ç¨‹é¡ºåºæ‰§è¡Œ</strong>ï¼šé¿å…çº¿ç¨‹å®‰å…¨é—®é¢˜<br />- <strong>æ— é”è®¾è®¡</strong>ï¼šæé«˜æ€§èƒ½<br />- <strong>äº‹ä»¶é©±åŠ¨</strong>ï¼šé«˜æ•ˆå¤„ç†å¤§é‡è¿æ¥</p><p><h3>5. å¼‚å¸¸ä¼ æ’­æ•ˆæœ</h3></p><p>å½“Handlerä¸­å‘ç”Ÿå¼‚å¸¸æ—¶ï¼š<br />```java<br />@Override<br />public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) {<br />    cause.printStackTrace();<br />    ctx.close(); // å…³é—­è¿æ¥<br />}<br />```</p><p>å¼‚å¸¸ä¼šæ²¿ç€Pipelineå‘åä¼ æ’­ï¼Œç›´åˆ°è¢«å¤„ç†æˆ–åˆ°è¾¾æœ«å°¾ã€‚</p><p><h2>Pipelineé“¾è·¯çš„æ ¸å¿ƒä¼˜åŠ¿</h2></p><p>1. <strong>èŒè´£åˆ†ç¦»</strong>ï¼šæ¯ä¸ªHandlerä¸“æ³¨å•ä¸€åŠŸèƒ½<br />2. <strong>å¯ç»„åˆæ€§</strong>ï¼šçµæ´»é…ç½®Handlerç»„åˆ<br />3. <strong>å¯é‡ç”¨æ€§</strong>ï¼šHandlerå¯åœ¨ä¸åŒPipelineä¸­å¤ç”¨<br />4. <strong>é«˜æ€§èƒ½</strong>ï¼šå•çº¿ç¨‹æ— é”è®¾è®¡<br />5. <strong>æ˜“æ‰©å±•</strong>ï¼šæ·»åŠ æ–°åŠŸèƒ½åªéœ€æ–°å¢Handler</p><p>è¿™ç§è®¾è®¡ä½¿Nettyèƒ½å¤Ÿé«˜æ•ˆå¤„ç†å¤æ‚çš„ç½‘ç»œé€šä¿¡åœºæ™¯ï¼ŒåŒæ—¶ä¿æŒä»£ç çš„æ¸…æ™°å’Œå¯ç»´æŠ¤æ€§ã€‚</p><p>```java<br />// Pipelineé…ç½®é¡ºåº<br />pipeline.addLast("decoder", new StringDecoder(CharsetUtil.UTF_8));<br />pipeline.addLast("inbound1", new InboundHandler1());<br />pipeline.addLast("inbound2", new InboundHandler2());<br />pipeline.addLast("business", new BusinessHandler());<br />pipeline.addLast("outbound1", new OutboundHandler1());<br />pipeline.addLast("outbound2", new OutboundHandler2());<br />pipeline.addLast("encoder", new StringEncoder(CharsetUtil.UTF_8));<br />```</p><p>```plaintext<br />Socketæ•°æ® â†’ decoder â†’ inbound1 â†’ inbound2 â†’ business â†’ ä¸šåŠ¡å¤„ç†<br />```</p><p>```plaintext<br />ä¸šåŠ¡å¤„ç† â†’ outbound2 â†’ outbound1 â†’ encoder â†’ Socketå‘é€<br />```</p><p>```java<br />// æ–¹å¼1ï¼šä»å½“å‰ä½ç½®å¼€å§‹çš„Outboundé“¾<br />ctx.writeAndFlush(response);</p><p>// æ–¹å¼2ï¼šä»Pipelineå°¾éƒ¨å¼€å§‹çš„å®Œæ•´Outboundé“¾<br />ctx.channel().writeAndFlush(response);<br />```</p><p>```java<br />@Override<br />public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception {<br />    System.out.println("\n=== æœåŠ¡å™¨ç«¯äº‹ä»¶: channelRead (InboundHandler) ===");<br />    System.out.println("   æ¶ˆæ¯ç»è¿‡çš„Handler: decoder -> serverHandler");<br />    <br />    String response = "Echo: " + msg;<br />    ctx.writeAndFlush(response);<br />    System.out.println("   å“åº”å°†ç»è¿‡çš„Handler: serverHandler -> encoder");<br />}<br />```</p><p>```java<br />@Override<br />public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) {<br />    cause.printStackTrace();<br />    ctx.close(); // å…³é—­è¿æ¥<br />}<br />```</p><p></p>
            </main>
            
            <!-- æ–‡ç« åº•éƒ¨ -->
            <footer class="post-footer">
                <div class="post-actions">
                    <button class="back-button" onclick="history.back()">â† è¿”å›ä¸Šé¡µ</button>
                    <a href="../../blog.html" class="more-posts-link">æŸ¥çœ‹æ›´å¤šæ–‡ç«  â†’</a>
                </div>
                
                <!-- æ–‡ç« æ ‡ç­¾ -->
                <div class="post-tags">
                    <span class="tag-label">æ ‡ç­¾ï¼š</span>
                    <span class="tag">Java</span>
                </div>
                
                <!-- ç‰ˆæƒä¿¡æ¯ -->
                <div class="post-copyright">
                    <p>æœ¬æ–‡ç”±æŠ€æœ¯åšå®¢åŸåˆ›ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚æ¬¢è¿åˆ†äº«ä¸äº¤æµï¼</p>
                </div>
            </footer>
        </article>
    </div>

    <!-- JavaScriptæ–‡ä»¶ -->
    <script src="../../scripts/highlight.js"></script>
    <script src="../../scripts/reading-toolbar.js"></script>
    <script src="../../scripts/table-of-contents.js"></script>
    
    <!-- é¡µé¢æ€§èƒ½ç›‘æ§ -->
    <script>
        // ç®€å•çš„é¡µé¢åŠ è½½æ€§èƒ½ç›‘æ§
        window.addEventListener('load', function() {
            const loadTime = window.performance.timing.loadEventEnd - window.performance.timing.navigationStart;
            console.log('é¡µé¢åŠ è½½æ—¶é—´:', loadTime + 'ms');
        });
    </script>
</body>
</html>